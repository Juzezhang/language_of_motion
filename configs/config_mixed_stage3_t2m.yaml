NAME: Instruct_Mixed_A2M # Experiment names
ACCELERATOR: 'gpu' # Devices optioncal: “cpu”, “gpu”, “tpu”, “ipu”, “hpu”, “mps, “auto”
NUM_NODES: 1 # Number of GPU nodes for distributed training
DEVICE: [0] # Index of gpus eg. [0] or [0,1,2,3,4,5,6,7]

Selected_part: compositional  # defaut separate_rot
Representation_type:
  full_h3d:
    ori: beat_smplx_joints
    tar: beat_smplx_full
    vae_test_dim: 263
  full_rot:
    ori: beat_smplx_joints
    tar: beat_smplx_full
    vae_test_dim: 330
  compositional:
    face:
      ori: beat_smplx_joints
      tar: beat_smplx_face
      vae_test_dim: 106
    hand:
      ori: beat_smplx_joints
      tar: beat_smplx_hand
      vae_test_dim: 180
    upper:
      ori: beat_smplx_joints
      tar: beat_smplx_upper
      vae_test_dim: 78
    lower:
      ori: beat_smplx_joints
      tar: beat_smplx_lower
      vae_test_dim: 61


TRAIN:
  #---------------------------------
  STAGE: lm_instruct # stage "vae" , "lm_pretrain", "lm_instruct"
  #---------------------------------
  NUM_WORKERS: 8 # Number of workers
  BATCH_SIZE: 24 # Size of batches  12
  END_EPOCH: 999999 # End epoch
  PRECISION: 'bf16'
  FORCE_BF16: False
  RESUME: '' # Resume training from this path
  PRETRAINED: '' # Preatrained model path
  PRETRAINED_VQ: './model_files/pretrained_cpt/emage_vq/vq_emage_speaker_2.ckpt' # Preatrained vq model path

  OPTIM:
    target: AdamW
    params:
      lr: 2e-4
      betas: [0.9, 0.99]
      weight_decay: 0.0


LOSS:
  LAMBDA_FEATURE: 1.0
  LAMBDA_VELOCITY: 0.5
  LAMBDA_COMMIT: 0.02
  LAMBDA_CLS: 1.0
ABLATION:
  RECONS_LOSS: 'l1_smooth'



# Evaluating Configuration
EVAL:
  BATCH_SIZE: 32 # Evaluating Batch size
  SPLIT: test

TEST:
  CHECKPOINTS_FACE: ./model_files/pretrained_cpt/emage_vq/vq_emage_speaker_2.ckpt
  CHECKPOINTS_HAND: ./model_files/pretrained_cpt/emage_vq/vq_emage_speaker_2.ckpt
  CHECKPOINTS_UPPER: ./model_files/pretrained_cpt/emage_vq/vq_emage_speaker_2.ckpt
  CHECKPOINTS_LOWER: ./model_files/pretrained_cpt/emage_vq/vq_emage_speaker_2.ckpt
  CHECKPOINTS_GLOBAL: ./model_files/pretrained_cpt/emage_vq/vq_emage_speaker_2.ckpt
  CHECKPOINTS: './model_files/pretrained_cpt/lom_a2m/Instruct_Mixed_A2M_LM.ckpt'
  SPLIT: test
  BATCH_SIZE: 1 # training Batch size
  TEST_LENGTH: 120

DATASET:
  vary_length: False
  pose_fps: 30
  unit_length: 1
  pre_frames: 4
  test_length: 120
  audio_fps: 16000
  audio_down: 320
  motion_representation: "rotation" # "rotation" or "h3d"
  target: lom.data.MixedDataset.MixedDataModule
  datasets:
    - name: "BEAT2"
      code_path_audio: "audios_token"
      stride: 20
      training_speakers: [2]
      testing_speakers: [2]
      additional_data: True # True or False
      pose_rep: smplxflame_30
      # code_path: "TOKENS_DS4"
      instructions_file: "template_instructions_beat2_minimal.json"
  datasets_test:
    - name: "BEAT2"
      code_path_audio: "audios_token"
      stride: 20
      training_speakers: [2]
      testing_speakers: [2]
      additional_data: True # True or False
      pose_rep: smplxflame_30
      # code_path: "TOKENS_DS4"
      instructions_file: "template_instructions_beat2_minimal.json"

METRIC:
  TYPE: ['CoSpeechMetrics']


model:
  target: lom.models.lom.Language_Motion
  params:
    task: 'a2m'
    lm: ${lm.lom_speaker2}
    modality_setup:
      params:
        audio_fps: ${lm.lom_speaker2.params.audio_samplerate}
        audio_down: ${lm.lom_speaker2.params.audio_down_sampling}  ## since the hubert model is trained on 320hz audio, and we found also have another version of hubert model trained on 640 downsampling setup
        motion_fps: ${lm.lom_speaker2.params.motion_framerate}
        motion_down: ${lm.lom_speaker2.params.motion_down_sampling}
    modality_tokenizer:
      vae_face:
        target: lom.archs.lom_vq.VQVAEConvZero
        params:
          vae_layer: 2
          code_num: 256
          codebook_size: 256
          vae_quantizer_lambda: 1
          vae_test_dim: ${Representation_type.${Selected_part}.face.vae_test_dim}  #dynamic
      vae_hand:
        target: lom.archs.lom_vq.VQVAEConvZero
        params:
          vae_layer: 2
          code_num: 256
          codebook_size: 256
          vae_quantizer_lambda: 1
          vae_test_dim: ${Representation_type.${Selected_part}.hand.vae_test_dim}  #dynamic
      vae_upper:
        target: lom.archs.lom_vq.VQVAEConvZero
        params:
          vae_layer: 2
          code_num: 256
          codebook_size: 256
          vae_quantizer_lambda: 1
          vae_test_dim: ${Representation_type.${Selected_part}.upper.vae_test_dim}  #dynamic
      vae_lower:
        target: lom.archs.lom_vq.VQVAEConvZero
        params:
          vae_layer: 4
          code_num: 256
          codebook_size: 256
          vae_quantizer_lambda: 1
          vae_test_dim: ${Representation_type.${Selected_part}.lower.vae_test_dim}  #dynamic
      vae_global:
        target: lom.archs.lom_vq.VAEConvZero
        params:
          vae_layer: 4
          code_num: 256
          codebook_size: 256
          vae_quantizer_lambda: 1
          vae_test_dim: 61

LOGGER:
  TYPE: ['wandb']
  VAL_EVERY_STEPS: 1
  WANDB:
    params:
      project: language_motion
